mandatory: True
code: |
  import requests
  import tempfile
  import docassemble.l4.intgen
  scasp_file
  lexsis_file
  install_interview
  link_to_interview
---
code: |
  user = requests.get('http://localhost/api/user', params={'key': api_key})
  user_data = json.loads(user.text)
  user_id = user_data['id']
---
code: |
  static_files_response = requests.get("http://localhost/api/playground", params={'key': api_key})
  playground_static_files = json.loads(static_files_response.text)
  # Get the text of the two input files
  download_scasp_response = requests.get("http://localhost/api/playground", params={'key': api_key, 'filename': scasp_file})
  scasp_source = download_scasp_response.text
  download_lexsis_response = requests.get("http://localhost/api/playground", params={'key': api_key, 'filename': lexsis_file})
  lexsis_source = download_lexsis_response.text
  # Generate the interview, save it to a temporary file, get the filename
  new_interview_source = docassemble.l4.intgen.generate_interview(lexsis_source,scasp_source)
  new_interview_file = tempfile.NamedTemporaryFile(mode="w+",delete=False)
  new_interview_file.write(new_interview_source)
  new_interview_filename = new_interview_file.name
  new_interview_file.close()
  del new_interview_file
  # Upload the temporary file to the playground
  upload_response = requests.post('http://localhost/api/playground', params={'key': api_key}, data={'folder': 'questions'}, files={'upload': new_interview_filename})
  
  # Note finished.
  install_interview = True
---
question: Enter the API Key
subquestion: |
  This is required in order to install the generated interview on your docassemble server.

  You can create or find the API key by clicking [here](/manage_api), clicking "New", giving the API key a name, choosing
  "No Authentication" as the security method, and clicking "Create".

  Then copy the API Key into the field below and click "Continue".

fields:
  - API Key: api_key
---
question: Choose an s(CASP) File
subquestion: |
  Please choose an s(CASP) file from your playground static folder to use for this interview.
fields:
  - s(CASP) File: scasp_file
    datatype: dropdown
    code: playground_static_files
---
question: Choose a LExSIS File
subquestion: |
  Please choose a LExSIS file from your playground static folder to use for this interview.
fields:
  - LExSIS File: lexsis_file
    datatype: dropdown
    code: playground_static_files
---
sets: link_to_interview
question: Run the New Interview
subquestion: |
  [Click here](/interview?i=docassemble.playground${ user_id }:${ new_interview_filename }) to run the new interview.